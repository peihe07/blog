+++
date = '2025-04-04'
draft = false
title = '區塊鏈共識協定'
categories = ['筆記']
tags = ['protocol']
+++

# PoW (Proof of Work)

- **工作原理**：
  * **雜湊運算**：尋找符合難度要求的雜湊值
  * **隨機數 (Nonce)**：調整參數直到找到正確解
  * **難度調整**：根據全網算力動態調整
- **安全模型**：
  * **51% 攻擊門檻**：需要控制超過一半算力
  * **誠實節點假設**：多數節點是誠實的
  * **經濟激勵**：挖礦獎勵 > 攻擊成本
- **比特幣實作**：
  * **SHA-256 雜湊**：雙重 SHA-256 運算
  * **區塊時間**：平均 10 分鐘
  * **難度調整**：每 2016 個區塊 (約 2 週)
- **獎勵機制**：
  * **區塊獎勵**：新產生的加密貨幣
  * **交易費用**：用戶支付的手續費
  * **減半機制**：比特幣每 4 年減半
- **能源消耗**：
  * **高耗能**：全球電力消耗量級
  * **專用硬體**：ASIC 礦機
  * **環境爭議**：碳排放和永續性問題
- **優勢與劣勢**：
  * **優勢**：高安全性、去中心化、經過驗證
  * **劣勢**：能源消耗大、交易速度慢、擴展性差

# PoS (Proof of Stake)

- **基本概念**：
  * **權益代替算力**：持有代幣量決定驗證權重
  * **質押機制**：鎖定代幣參與共識
  * **隨機選擇**：基於權益的隨機驗證者選擇
- **以太坊 2.0 實作**：
  * **32 ETH 最低質押**：成為驗證者的門檻
  * **獎勵分配**：基於參與度和正確性
  * **罰沒機制**：惡意行為或離線懲罰
- **共識流程**：
  * **提案階段**：驗證者提出新區塊
  * **證明階段**：其他驗證者投票確認
  * **最終確定**：達到共識閾值
- **Casper FFG**：
  * **友好的最終性小工具**：以太坊 PoS 實作
  * **檢查點**：每 32 個區塊的最終確認
  * **罰沒條件**：雙重投票、環繞投票
- **代幣經濟學**：
  * **通膨控制**：新發行代幣獎勵驗證者
  * **費用燃燒**：EIP-1559 燃燒機制
  * **質押收益**：年化報酬率 4-6%
- **優勢與挑戰**：
  * **優勢**：低能耗、快速最終確定、經濟安全
  * **挑戰**：長程攻擊、初始分配、質押集中化

# DPoS (Delegated Proof of Stake)

- **委託機制**：
  * **投票選舉**：代幣持有者投票選出代表
  * **代表節點**：固定數量的驗證者（如 21 個）
  * **輪流出塊**：代表按順序產生區塊
- **EOS 實作**：
  * **21 個 BP (Block Producers)**：主要出塊節點
  * **備用 BP**：候選節點，可隨時替換
  * **3 秒出塊**：快速交易確認
- **治理機制**：
  * **持續投票**：可隨時改變投票
  * **代表更替**：表現不佳的代表被替換
  * **鏈上治理**：協定參數投票決定
- **獎勵分配**：
  * **出塊獎勵**：代表節點獲得主要獎勵
  * **投票者分紅**：部分獎勵分配給投票者
  * **生態基金**：支持開發和營運
- **安全模型**：
  * **2/3+1 安全**：需要超過 2/3 代表合作攻擊
  * **投票制衡**：社群可投票移除惡意代表
  * **經濟懲罰**：代表惡意行為的經濟損失
- **優勢與爭議**：
  * **優勢**：高 TPS、低延遲、民主治理
  * **爭議**：中心化風險、財閥政治、投票率低

# PBFT (Practical Byzantine Fault Tolerance) 

- **拜占庭問題**：
  * **惡意節點容忍**：可容忍 1/3 惡意節點
  * **一致性保證**：確保所有誠實節點達成一致
  * **活性保證**：系統最終會取得進展
- **三階段共識**：
  * **預準備 (Pre-prepare)**：主節點提出提案
  * **準備 (Prepare)**：節點廣播同意訊息
  * **提交 (Commit)**：節點廣播承諾訊息
- **視圖變更 (View Change)**：
  * **主節點失效**：偵測並替換失效主節點
  * **超時機制**：設定階段超時時間
  * **新視圖**：選舉新主節點並重新開始
- **Hyperledger Fabric 應用**：
  * **排序服務**：使用 PBFT 進行交易排序
  * **聯盟鏈適用**：已知參與者身份
  * **權限網路**：需要授權才能加入
- **效能特性**：
  * **低延遲**：通常 3 個訊息回合
  * **確定性最終確定**：即時最終確認
  * **通信複雜度**：O(n²) 訊息複雜度
- **適用場景**：
  * 聯盟鏈和私有鏈
  * 金融機構間清算
  * 供應鏈管理
  * 政府間協作

# 區塊鏈共識協定比較
  | 協定 | TPS | 能耗 | 去中心化 | 最終確定性 | 適用場景 |
|------|-----|------|----------|------------|----------|
| PoW | 低 (7) | 極高 | 高 | 機率性 | 公有鏈 |
| PoS | 中 (1000) | 低 | 中-高 | 快速 | 公有鏈 2.0 |
| DPoS | 高 (4000) | 極低 | 中 | 快速 | 高性能公鏈 |
| PBFT | 中 (1000) | 低 | 低 | 即時 | 聯盟鏈 |